<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Galería</title>
    <style>
        body { 
            margin: 0; padding: 0; background-color: #0e0e0e; color: white; 
            font-family: 'Segoe UI', sans-serif; overflow: hidden; height: 100dvh; display: flex; flex-direction: column;
            user-select: none; -webkit-user-select: none;
        }

        /* UI */
        .top-bar { height: 50px; background: #1a1a1a; display: flex; justify-content: space-between; align-items: center; padding: 0 15px; border-bottom: 1px solid #333; z-index: 20; flex-shrink: 0; }
        .project-title { font-weight: bold; color: #27ae60; text-transform: uppercase; letter-spacing: 1px; font-size: 0.8rem; max-width: 60%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .close-btn { background: #c0392b; color: white; border: none; padding: 8px 12px; border-radius: 4px; font-weight: bold; text-decoration: none; font-size: 0.75rem; }

        /* VISOR */
        .viewer-container { flex: 1; width: 100%; overflow: auto; display: flex; position: relative; background-color: #000; outline: none; }
        .lb-scroll-container { min-width: 100%; min-height: 100%; display: flex; padding: 0; box-sizing: border-box; justify-content: center; align-items: center; }
        #main-image { max-width: 95%; max-height: 70dvh; box-shadow: 0 0 20px rgba(0,0,0,0.5); transition: width 0.1s ease; opacity: 0; flex-shrink: 0; }

        /* NAVEGACIÓN */
        .nav-btn { position: absolute; top: 50%; transform: translateY(-50%); width: 60px; height: 100px; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.2); color: white; font-size: 3rem; cursor: pointer; z-index: 30; transition: 0.2s; user-select: none; }
        .nav-btn:hover { background: rgba(39, 174, 96, 0.5); }
        .prev { left: 0; } .next { right: 0; }
        @media (max-width: 768px) { .nav-btn { display: none; } }

        /* FOOTER */
        .bottom-bar { height: 90px; background: #1a1a1a; border-top: 1px solid #333; display: flex; flex-direction: column; align-items: center; padding: 10px; z-index: 20; flex-shrink: 0; gap: 8px; }
        .zoom-controls { display: flex; gap: 15px; }
        .zoom-btn { background: #333; color: white; border: 1px solid #555; width: 40px; height: 40px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; display: flex; justify-content: center; align-items: center; }
        .zoom-btn:active { background: #27ae60; border-color: #27ae60; }
        .thumbnails { width: 100%; display: flex; gap: 10px; overflow-x: auto; height: 50px; align-items: center; padding-bottom: 5px; justify-content: center; }
        .thumb { height: 40px; border-radius: 4px; cursor: pointer; opacity: 0.5; transition: 0.2s; border: 2px solid transparent; flex-shrink: 0; }
        .thumb.active { opacity: 1; border-color: #27ae60; transform: scale(1.1); }

        /* EXTRAS */
        .loader { border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid #27ae60; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; position: absolute; top: 50%; left: 50%; margin-left: -20px; margin-top: -20px; z-index: 5; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-msg { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #e74c3c; text-align: center; width: 80%; z-index: 6; font-size: 0.9rem; }
        
        #custom-context-menu { display: none; position: fixed; background: rgba(231, 76, 60, 0.95); color: white; padding: 10px; border-radius: 5px; font-size: 0.8rem; pointer-events: none; z-index: 10000; }
        #screenshot-blocker { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 10000; justify-content: center; align-items: center; flex-direction: column; text-align: center; }
        #screenshot-blocker h1 { color: #e74c3c; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="custom-context-menu">⛔ Prohibido Copiar - Contacto: 0963036594</div>
    <div id="screenshot-blocker"><h1>⛔ ALERTA</h1><p>Captura no permitida.</p></div>

    <div class="top-bar">
        <div class="project-title" id="project-name">Cargando...</div>
        <a href="index.html" class="close-btn">✖ VOLVER</a>
    </div>

    <div class="viewer-container" id="scroll-area" tabindex="0">
        <div class="nav-btn prev" onclick="changeSlide(-1)">&#10094;</div>
        <div class="nav-btn next" onclick="changeSlide(1)">&#10095;</div>
        <div class="lb-scroll-container">
            <div class="loader" id="loader"></div>
            <div class="error-msg" id="error-msg">❌ No carga</div>
            <img id="main-image" src="" alt="" ondragstart="return false">
        </div>
    </div>

    <div class="bottom-bar">
        <div class="zoom-controls">
            <button class="zoom-btn" onclick="manualZoom(-0.1)">➖</button>
            <button class="zoom-btn" onclick="resetZoom()">⟲</button>
            <button class="zoom-btn" onclick="manualZoom(0.1)">➕</button>
        </div>
        <div class="thumbnails" id="thumbs-container"></div>
    </div>

    <script>
        const db = {
            'science': { 
                title: 'Ilustración Científica', 
                images: ['cangrejo1.jpg', 'caracol.jpg', 'tipula.jpg'] 
            },
            'curativa': { 
                title: 'Curativa Cosmética', 
                images: [
                    'curativa.png', 
                    'Manual1.png', 'Manual2.png', 'Manual3.png', 'Manual4.png', 'Manual5.png', 'Manual6.png', 'Manual7.png',
                    'desodorante.png', 'balsamo.png', 
                    'Logonegativo.png', 
                    'logousonormal.png'
                ] 
            },
            'cultura': { title: 'Cultura Saraguro', images: ['saraguro1.jpg', 'saraguro2.jpg', 'saraguro3.jpg', 'saraguro4.jpg'] },
            'finca': { title: 'Finca Pindaca', images: ['finca.jpeg'] },
            'tiny': { 
                title: 'Tiny Melts', 
                images: [
                    'tinimeltslogo.png', // Nombre real en carpeta (tini)
                    'tinymeltsbrandboard.png', // Nombre real en carpeta (tiny)
                    'tinymeltslogoalternativa.png' // Nombre real en carpeta
                ] 
            },
            'flyer': { title: 'Diseño Promocional', images: ['talleresvacacionales.jpg', '5elementos.jpg'] },
            'encuentros': { title: 'Los Encuentros NET', images: ['losencuentros.png'] }
        };

        const noZoomFiles = ['tipula.jpg']; 

        let currentProjectImages = [];
        let currentIndex = 0;
        let currentScale = 1.0;
        let isZoomingOut = false;
        let isZoomAllowed = true;

        const imgEl = document.getElementById('main-image');
        const thumbsDiv = document.getElementById('thumbs-container');
        const titleDiv = document.getElementById('project-name');
        const loader = document.getElementById('loader');
        const errorMsg = document.getElementById('error-msg');
        const zoomControls = document.querySelector('.zoom-controls');
        
        const contextMenu = document.getElementById('custom-context-menu');
        const screenBlocker = document.getElementById('screenshot-blocker');

        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');
        const project = db[id];

        if (project) {
            titleDiv.textContent = project.title;
            currentProjectImages = project.images;
            initGallery();
            document.querySelector('.viewer-container').focus();
        } else {
            titleDiv.textContent = "Error";
            loader.style.display = 'none';
            errorMsg.innerHTML = "Selecciona un proyecto desde el Inicio";
            errorMsg.style.display = 'block';
        }

        function initGallery() {
            thumbsDiv.innerHTML = '';
            currentProjectImages.forEach((src, index) => {
                const t = document.createElement('img');
                t.src = src; t.className = 'thumb';
                t.onclick = () => loadIndex(index);
                t.onerror = () => { t.style.display = 'none'; };
                thumbsDiv.appendChild(t);
            });
            loadIndex(0);
        }

        function changeSlide(direction) {
            let newIndex = currentIndex + direction;
            if (newIndex < 0) newIndex = currentProjectImages.length - 1;
            if (newIndex >= currentProjectImages.length) newIndex = 0;
            loadIndex(newIndex);
        }

        function loadIndex(index) {
            currentIndex = index;
            const src = currentProjectImages[currentIndex];
            
            document.querySelectorAll('.thumb').forEach(t => t.classList.remove('active'));
            if(thumbsDiv.children[index]) {
                thumbsDiv.children[index].classList.add('active');
                thumbsDiv.children[index].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }

            loader.style.display = 'block';
            errorMsg.style.display = 'none';
            imgEl.style.opacity = '0';
            imgEl.src = ''; 

            if (noZoomFiles.some(file => src.includes(file))) {
                isZoomAllowed = false;
                zoomControls.style.display = 'none';
            } else {
                isZoomAllowed = true;
                zoomControls.style.display = 'flex';
            }

            imgEl.src = src;

            const loadTimeout = setTimeout(() => {
                if (imgEl.style.opacity === '0') {
                    loader.style.display = 'none';
                    errorMsg.innerHTML = `⚠️ Tiempo de espera.<br>Archivo: ${src}`;
                    errorMsg.style.display = 'block';
                }
            }, 5000);

            imgEl.onload = () => {
                clearTimeout(loadTimeout);
                loader.style.display = 'none';
                imgEl.style.opacity = '1';
                resetZoom(true);
            };

            imgEl.onerror = () => {
                clearTimeout(loadTimeout);
                loader.style.display = 'none';
                errorMsg.style.display = 'block';
                errorMsg.innerHTML = `❌ No encontrado:<br>${src}`;
            };
        }

        // TOUCH & KEYBOARD
        let touchStartX = 0;
        document.querySelector('.viewer-container').addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, {passive: true});
        document.querySelector('.viewer-container').addEventListener('touchend', e => {
            let touchEndX = e.changedTouches[0].screenX;
            if (currentScale <= 1.1) {
                if (touchEndX < touchStartX - 50) changeSlide(1);
                if (touchEndX > touchStartX + 50) changeSlide(-1);
            }
        }, {passive: true});

        window.addEventListener('keydown', e => {
            if (e.key === 'ArrowRight') changeSlide(1);
            if (e.key === 'ArrowLeft') changeSlide(-1);
            if (e.key === 'Escape') window.location.href = 'index.html';
            if (e.key === 'PrintScreen') {
                screenBlocker.style.display = 'flex';
                setTimeout(() => screenBlocker.style.display = 'none', 2000);
            }
            if (e.ctrlKey && (e.key === 'p' || e.key === 's' || e.key === 'u')) e.preventDefault();
        });

        // ZOOM
        function resetZoom(isInitial = false) {
            currentScale = 1.0; isZoomingOut = false;
            const container = document.querySelector('.lb-scroll-container');
            const isVertical = imgEl.naturalHeight > imgEl.naturalWidth * 1.2; 

            if((isInitial && isVertical) || !isZoomAllowed) {
                imgEl.style.width = '95%'; imgEl.style.maxWidth = '800px';
                imgEl.style.height = 'auto'; imgEl.style.maxHeight = 'none';
                container.style.alignItems = 'flex-start'; 
            } else {
                imgEl.style.width = 'auto'; imgEl.style.height = 'auto';
                imgEl.style.maxWidth = '95%'; imgEl.style.maxHeight = '70dvh';
                container.style.alignItems = 'center';
            }
            container.style.justifyContent = 'center';
        }

        function applyZoom() {
            if (!isZoomAllowed) return;
            imgEl.style.maxWidth = 'none'; imgEl.style.maxHeight = 'none';
            const container = document.querySelector('.lb-scroll-container');
            container.style.alignItems = 'flex-start';
            container.style.justifyContent = 'flex-start';
            const newWidth = imgEl.naturalWidth * currentScale;
            if(newWidth < window.innerWidth) container.style.justifyContent = 'center';
            else container.style.justifyContent = 'flex-start';
            imgEl.style.width = newWidth + 'px';
        }

        function manualZoom(delta) {
            if (!isZoomAllowed) return;
            if(imgEl.style.maxWidth !== 'none') currentScale = imgEl.offsetWidth / imgEl.naturalWidth;
            currentScale += delta;
            if(currentScale < 0.1) currentScale = 0.1;
            if(currentScale > 3.0) currentScale = 3.0; 
            if(currentScale < 3.0) isZoomingOut = false;
            applyZoom();
        }

        imgEl.addEventListener('click', () => {
            if (!isZoomAllowed) return;
            if(imgEl.style.maxWidth !== 'none') currentScale = imgEl.offsetWidth / imgEl.naturalWidth;
            if(!isZoomingOut) {
                currentScale += 0.1; if(currentScale >= 1.5) { currentScale = 1.5; isZoomingOut = true; }
            } else {
                currentScale -= 0.3; if(currentScale <= 0.3) { resetZoom(); return; }
            }
            applyZoom();
        });

        imgEl.addEventListener('wheel', (e) => {
            if (!isZoomAllowed) return;
            e.preventDefault();
            if(imgEl.style.maxWidth !== 'none') currentScale = imgEl.offsetWidth / imgEl.naturalWidth;
            if(e.deltaY < 0) currentScale += 0.05; else currentScale -= 0.05;
            if(currentScale < 0.1) currentScale = 0.1; if(currentScale > 2.5) currentScale = 2.5; 
            if(currentScale < 2.5) isZoomingOut = false;
            applyZoom();
        });

        document.addEventListener('contextmenu', e => {
            e.preventDefault();
            const x = window.innerWidth < 768 ? '50%' : e.clientX + 'px';
            const y = window.innerWidth < 768 ? '50%' : e.clientY + 'px';
            const tr = window.innerWidth < 768 ? 'translate(-50%, -50%)' : 'none';
            contextMenu.style.left = x; contextMenu.style.top = y; contextMenu.style.transform = tr;
            contextMenu.style.display = 'block';
            setTimeout(() => contextMenu.style.display = 'none', 2000);
        });
    </script>
</body>
</html>